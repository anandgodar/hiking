---
/**
 * Seasonal Guide Component - Phase 2 Content
 * Location: src/components/SeasonalGuide.astro
 */

interface SeasonInfo {
  months: string;
  conditions: string;
  crowd_level: string;
  recommended: boolean;
  gear: string[];
  tips: string;
}

interface Props {
  seasons?: {
    spring?: SeasonInfo;
    summer?: SeasonInfo;
    fall?: SeasonInfo;
    winter?: SeasonInfo;
  };
  elevation?: number;
}

const { seasons, elevation = 4000 } = Astro.props;

const month = new Date().getMonth();
const currentSeason = month >= 2 && month <= 4 ? 'spring' 
  : month >= 5 && month <= 7 ? 'summer'
  : month >= 8 && month <= 10 ? 'fall' 
  : 'winter';

const defaultSeasons = {
  spring: {
    months: "March - May",
    conditions: "Muddy trails, snow at higher elevations, stream crossings high",
    crowd_level: "Low",
    recommended: elevation < 4000,
    gear: ["Waterproof boots", "Gaiters", "Extra layers", "Trekking poles"],
    tips: "Trails may be closed for mud season. Check trail conditions before heading out."
  },
  summer: {
    months: "June - August", 
    conditions: "Best hiking conditions, afternoon thunderstorms possible",
    crowd_level: "High",
    recommended: true,
    gear: ["Sun protection", "Bug spray", "2+ liters water", "Rain jacket"],
    tips: "Start early to avoid crowds and afternoon storms. Summit by noon if thunderstorms are forecast."
  },
  fall: {
    months: "September - November",
    conditions: "Peak foliage mid-September to mid-October, cooler temperatures",
    crowd_level: "Very High",
    recommended: true,
    gear: ["Layers", "Headlamp", "Warm hat/gloves", "Rain gear"],
    tips: "Parking lots fill early during foliage season. Arrive before 7am on weekends."
  },
  winter: {
    months: "December - February",
    conditions: elevation >= 4000 ? "Severe alpine conditions, high winds, extreme cold" : "Snow-covered trails, shorter days",
    crowd_level: "Low",
    recommended: elevation < 4000,
    gear: ["Microspikes/crampons", "Snowshoes", "Winter layers", "Emergency bivy"],
    tips: elevation >= 4000 ? "Winter hiking above treeline requires mountaineering experience." : "Beautiful snow hiking with proper gear."
  }
};

const displaySeasons = seasons || defaultSeasons;

const seasonColors = {
  spring: { bg: "bg-green-50", border: "border-green-200", text: "text-green-700", icon: "M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707" },
  summer: { bg: "bg-amber-50", border: "border-amber-200", text: "text-amber-700", icon: "M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M12 7a5 5 0 100 10 5 5 0 000-10z" },
  fall: { bg: "bg-orange-50", border: "border-orange-200", text: "text-orange-700", icon: "M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z" },
  winter: { bg: "bg-blue-50", border: "border-blue-200", text: "text-blue-700", icon: "M12 3v18m0-18l-3 3m3-3l3 3m-3 15l-3-3m3 3l3-3M3 12h18M3 12l3-3m-3 3l3 3m15-3l-3-3m3 3l-3 3" }
};
---

<section class="seasonal-guide py-8" id="when-to-visit">
  <h2 class="text-2xl font-bold text-stone-900 mb-6 flex items-center gap-2">
    <svg class="w-6 h-6 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
    </svg>
    Best Time to Visit
  </h2>

  <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-4">
    {Object.entries(displaySeasons).map(([season, info]) => {
      const colors = seasonColors[season];
      const isCurrent = season === currentSeason;
      
      return (
        <div class={`rounded-xl border-2 p-5 transition-all ${colors.bg} ${isCurrent ? 'border-emerald-500 ring-2 ring-emerald-200' : colors.border}`}>
          <div class="flex items-center justify-between mb-3">
            <svg class={`w-6 h-6 ${colors.text}`} fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d={colors.icon} />
            </svg>
            {isCurrent && (
              <span class="text-xs font-bold bg-emerald-500 text-white px-2 py-1 rounded-full">
                NOW
              </span>
            )}
          </div>
          
          <h3 class={`font-bold capitalize mb-1 ${colors.text}`}>{season}</h3>
          <p class="text-xs text-stone-500 mb-3">{info.months}</p>
          
          <p class="text-sm text-stone-600 mb-3">{info.conditions}</p>
          
          <div class="flex items-center gap-2 text-xs mb-3">
            <span class="text-stone-500">Crowds:</span>
            <span class={`font-medium ${info.crowd_level === 'Low' ? 'text-green-600' : info.crowd_level === 'High' ? 'text-orange-600' : 'text-red-600'}`}>
              {info.crowd_level}
            </span>
          </div>
          
          {info.recommended ? (
            <span class="inline-flex items-center gap-1 text-xs text-green-700 bg-green-100 px-2 py-1 rounded-full">
              <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
              </svg>
              Recommended
            </span>
          ) : (
            <span class="inline-flex items-center gap-1 text-xs text-amber-700 bg-amber-100 px-2 py-1 rounded-full">
              <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
              </svg>
              Caution
            </span>
          )}
        </div>
      );
    })}
  </div>

  <div class="mt-6 bg-stone-100 rounded-xl p-5">
    <h3 class="font-bold text-stone-900 mb-3 flex items-center gap-2">
      <svg class="w-5 h-5 text-stone-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4" />
      </svg>
      {currentSeason.charAt(0).toUpperCase() + currentSeason.slice(1)} Gear Checklist
    </h3>
    <ul class="grid grid-cols-2 gap-2">
      {displaySeasons[currentSeason]?.gear?.map(item => (
        <li class="flex items-center gap-2 text-sm text-stone-600">
          <input type="checkbox" class="rounded border-stone-300 text-emerald-600 focus:ring-emerald-500" />
          {item}
        </li>
      ))}
    </ul>
    <p class="mt-4 text-sm text-stone-500 italic">
      Tip: {displaySeasons[currentSeason]?.tips}
    </p>
  </div>
</section>
